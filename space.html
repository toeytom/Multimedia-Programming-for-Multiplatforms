<!DOCTYPE html>
<html lang ="en-US">
<head>
	<meta charset="utf-8">
	<title>Kahang</title>
	<script type="text/javascript" src="simpleGame.js"></script>
	<script type="text/javascript"> 
	var scene;
	var city; //bg
	var car; // kahang
	var tower=[]; //bamboo
	var heart=[];
	var score = 0;
	var dist;
	var distY;
	var position;


	


	function Car(){
		var tCar = new Sprite(scene,"hoverCar.png",50,50);
		tCar.setSpeed(0);
		
		// tCar.hSpeed = 0;
		tCar.checkKeys = function(){
			this.changeImage("hoverCar.png");
			
			if(keysDown[K_SPACE]){
				this.addVector(0,1.5);
				// this.changeImage("hoverCarThrust.png");
			}
		}
		tCar.checkGravity = function(){
			if(this.y >580){
				this.setPosition(this.x,580);

			}else{
				this.addVector(180,0.5);
			}
		}
		return tCar;
	}
	function Tower(){
		var tTower = new Sprite(scene,"top.png",30,350);
		tTower.setSpeed(0);

		return tTower;
	}
	function Heart(){
		var tHeart = new Sprite(scene,"heart.png",50,50);
		tHeart.setSpeed(0);

		return tHeart;
	}

	function checkCollisions(heartNum){
			if(car.collidesWith(heart[heartNum])){
				heart[heartNum].hide();
				score++;
				// console.log(score);
			}
		}
	function checkCollisionsTower(towerNum){
		if(tower[towerNum].collidesWith(car)){
			console.log("test")
			for(var i=0; i<8; i++){
				tower[i].setSpeed(0);
			}
			for(var i=0; i<4; i++){
				heart[i].setSpeed(0);
			}
		}
			
		
	}


	function showHeart(heartNum){
		if(heart[heartNum].x <= 0){
			heart[heartNum].show();

		}
	}
	function moveBamboo(){	
		
		// if(position <= tower[0].y+25){
		// 	for(var i =0; i<8; i++){
		// 		tower[i].addVector(0,0.5);
		// 	}
			
		// }if(position >= tower[0].y+25) {
		// 	for(var i =0; i<8; i++){
		// 		tower[i].addVector(180,0.5);
		// 	}
		// }

	}

	function init(){
		scene = new Scene();
		// scene.setSize(800,600);
		city = new Sprite(scene,"background3.jpg",800,600);
		city.setSpeed(0);
		city.setPosition(400,300);
		car = new Car();


		for(var i=0; i<8;i++){
			tower[i] = new Tower(); 
			tower[i].setSpeed(2);
			tower[i].changeMoveAngleBy(180);

			if(i==0){
				tower[i].setPosition(200,Math.random()*50+50);
				position = tower[i].y;
			}
			else if(i%2==0){
				tower[i].setPosition(tower[i-2].x+200,Math.random()*50+50);
			}else{
				tower[i].changeImage("bottom.png");
				tower[i].setPosition(tower[i-1].x,tower[i-1].y+480);

			}
		}

		for(var i=0; i<4;i++){
			heart[i] = new Heart();
			heart[i].setSpeed(2);
			heart[i].changeMoveAngleBy(180);

			heart[i].setPosition(tower[i*2].x,tower[i*2].y+220);
			
		}
		car.setPosition(125,heart[0].y+20);

		scene.start();
	}

	function update(){
		scene.clear();
		car.checkKeys();
		city.update();
		car.checkGravity();
		for(var i=0; i<8;i++){
			checkCollisionsTower(i);
			tower[i].update();
		}
		for(var i=0; i<4;i++){
			checkCollisions(i);
			showHeart(i);
			heart[i].update();

		}
		moveBamboo();
		car.update();

	}
	</script>
</head>
<body onload = "init()">

</body>
</html>