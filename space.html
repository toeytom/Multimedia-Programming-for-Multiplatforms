<!DOCTYPE html>
<html lang ="en-US">
<head>
	<meta charset="utf-8">
	<title>กระหังหรรษา</title>
	<script type="text/javascript" src="simpleGame.js"></script>
	<script type="text/javascript"> 
	var scene;
	var background; //bg
	var kahang; // kahang
	var tower=[]; //bamboo
	var heart=[];
	var score = 0;
	var dist;
	var distY;
	var position;


	


	function Kahang(){
		var tKahang = new Sprite(scene,"kahangCharacter1.png",800,200);
			
		tKahang.loadAnimation(800,200,100,100);
		tKahang.setSpeed(0);
		tKahang.generateAnimationCycles();
		tKahang.renameCycles(new Array("up","down"));
		tKahang.setAnimationSpeed(1000);
		tKahang.pauseAnimation();
		tKahang.setCurrentCycle("up");
			
		// kahang.loadAnimation(800,200,100,100);
		// kahang.setSpeed(0);
		// kahang.generateAnimationCycles();
		// kahang.renameCycles(new Array("up","down"));
		// kahang.setAnimationSpeed(1000);
		// kahang.pauseAnimation();
		// kahang.setCurrentCycle("up");
		
		tKahang.checkKeys = function(){
			this.changeImage("kahangCharacter1.png");
			
			if(keysDown[K_SPACE]){
				kahang.playAnimation();
				this.addVector(0,1);
				kahang.setCurrentCycle("up");
			}
		}
		tKahang.checkGravity = function(){
			if(this.y >540){
				this.setPosition(this.x,540);

			}
			else if(this.y < 70 ){
				this.setPosition(this.x,70);
				console.log("y " + this.y);
				this.addVector(180,0.5);
			}
			else{
				this.addVector(180,0.5);				
			}

		}
		return tKahang;
	}
	function Tower(){
		var tTower = new Sprite(scene,"top.png",30,350);
		tTower.setSpeed(0);

		return tTower;
	}
	function Heart(){
		var tHeart = new Sprite(scene,"heart.png",50,50);
		tHeart.setSpeed(0);

		return tHeart;
	}

	function checkCollisions(heartNum){

			if(newcollision(kahang,heart[heartNum])){
				heart[heartNum].hide();
				score++;
				// console.log("score"+score);
			}
		}
	function checkCollisionsTower(towerNum){
		// 
			
		
	}


	function showHeart(heartNum){
		if(heart[heartNum].x <= 0){
			heart[heartNum].show();

		}
	}
	function newcollision(a , b ){
	  if(a.x+50>=b.x-25&&(a.y+50>=b.y+25&&a.y-50<=b.y-25)  ){
		  return true;
	  }
	  else{
		  return false;
	  }

	}
	function moveBamboo(){	
		
		// if(position <= tower[0].y+25){
		// 	for(var i =0; i<8; i++){
		// 		tower[i].addVector(0,0.5);
		// 	}
			
		// }if(position >= tower[0].y+25) {
		// 	for(var i =0; i<8; i++){
		// 		tower[i].addVector(180,0.5);
		// 	}
		// }

	}

	function init(){
		scene = new Scene();
		// scene.setSize(800,600);
		background = new Sprite(scene,"background3.jpg",800,600);
		background.setSpeed(0);
		background.setPosition(400,300);
		kahang = new Kahang();

		

		for(var i=0; i<8;i++){
			tower[i] = new Tower(); 
			tower[i].setSpeed(2);
			tower[i].changeMoveAngleBy(180);

			if(i==0){
				tower[i].setPosition(200,Math.random()*50+50);
				position = tower[i].y;
			}
			else if(i%2==0){
				tower[i].setPosition(tower[i-2].x+200,Math.random()*50+50);
			}else{
				tower[i].changeImage("bottom.png");
				tower[i].setPosition(tower[i-1].x,tower[i-1].y+480);

			}
		}

		for(var i=0; i<4;i++){
			heart[i] = new Heart();
			heart[i].setSpeed(2);
			heart[i].changeMoveAngleBy(180);

			heart[i].setPosition(tower[i*2].x,tower[i*2].y+220);
			
		}
		
		
		kahang.setPosition(125,heart[0].y+20);
		scene.start();
	}

	function update(){
		scene.clear();
		kahang.checkKeys();
		background.update();
		kahang.checkGravity();
		for(var i=0; i<8;i++){
			checkCollisionsTower(i);
			tower[i].update();
		}
		for(var i=0; i<4;i++){
			checkCollisions(i);
			showHeart(i);
			heart[i].update();

		}
		moveBamboo();
		kahang.update();
		// console.log("w"+kahang.cWidth)

	}
	</script>
</head>
<body onload = "init()">

</body>
</html>