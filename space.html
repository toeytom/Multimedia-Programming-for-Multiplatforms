<!DOCTYPE html>
<html lang ="en-US">
<head>
	<meta charset="utf-8">
	<title>กระหังหรรษา</title>
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">
	<link rel="stylesheet" href="css/css.css">
	<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T" crossorigin="anonymous"></script>
	<script type="text/javascript" src="simpleGame.js"></script>
	<script type="text/javascript"> 
	var scene;
	var background; //bg
	var kahang; // kahang
	var kahangStart; // kahangStart
	var tower=[]; //bamboo
	var heart=[];
	var score = -1;
	var dist;
	var distY;
	var position;
	var position2;
	var statusPlay = false
	var logo 
	var but
	var labelscore
	var playkahang =false
	var tutorial 
	var buttutorial
	var die=false
	var diescore
	var playagainBut
	var butLeft
	var butRight
	// var speed=0.5;




	//starScene

	function kahangStartScene(){
		var tKahang = new Sprite(scene,"images/1x/kahangSprites.png",3200,800);
		tKahang.loadAnimation(1600,400,400,399.9);
		tKahang.setSpeed(0);
		tKahang.generateAnimationCycles();
		tKahang.renameCycles(new Array("up","down"));
		tKahang.setAnimationSpeed(1500);
		tKahang.playAnimation();
		tKahang.setCurrentCycle("up");
	

		return tKahang;
	}

	function startScene(){
		scene = new Scene();
		scene.setSize(1024, 650);
		background = new Sprite(scene, "images/1x/bgStart.png", 1024, 650);
		background.setSpeed(0);
		background.setPosition(512, 325);
		but=new Sprite(scene,"images/1x/startBtn_1.png",150,50)
		but.setSpeed(0);
		but.setPosition(512,600)

		kahangStart = new kahangStartScene();
		kahangStart.setPosition(500, 200);
		logo =new Sprite(scene,"images/1x/nameStart.png",400,150)
		logo.setSpeed(0);
		logo.setPosition(512,420)
		scene.start();
	
	}


	//end
	


	function Kahang(){
		var tKahang = new Sprite(scene,"kahang2.png",800,200);
			
		tKahang.loadAnimation(800,200,100,100);
		tKahang.setSpeed(0);
		tKahang.generateAnimationCycles();
		tKahang.renameCycles(new Array("up","down"));
		tKahang.setAnimationSpeed(1000);
		tKahang.playAnimation();
		tKahang.setCurrentCycle("down");
		
		tKahang.checkKeys = function(){
			if(playkahang){
			this.changeImage("kahang2.png");
			if((keysDown[K_SPACE]&&!die)||(butLeft.isMouseDown()&&!die)||(butRight.isMouseDown()&&!die)){
				kahang.playAnimation();
				this.addVector(0,1.5);
				kahang.setCurrentCycle("up");
			}
		}
		}
		tKahang.checkGravity = function(){
			if(playkahang){
			if(this.y >540){
				this.setPosition(this.x,540);

			}
			else if(this.y < 70 ){
				this.setPosition(this.x,70);
				console.log("y " + this.y);
				this.addVector(180,0.5);
			}
			else{
				
				this.addVector(180,0.5);				
			}
		}

		}
		return tKahang;
	}
	function Tower(){
		var tTower = new Sprite(scene,"top.png",30,350);
		tTower.setSpeed(0);

		return tTower;
	}
	function Heart(){
		var tHeart = new Sprite(scene,"heart.png",50,50);
		tHeart.setSpeed(0);

		return tHeart;
	}

	function checkCollisions(heartNum){

			if(heart[heartNum].collidesWithnew(kahang,100,100)){
				heart[heartNum].hide();
				score +=1 ;
				labelscore.setLabel("ได้ "+score+" คะแนน")
			}
		}
	
	
		
	
	function checkCollisionsTower(towerNum){
		if(towerNum%2==0){

			var boundbut = kahang.y-50<tower[towerNum].y+175
			var boundleft = kahang.x-50<tower[towerNum].x+10
			var boundright = kahang.x+50>tower[towerNum].x-10
		
		if(boundbut&&boundleft&&boundright){
			die =true
			// alert(score)
			diescore.show()
		playagainBut.show()
			for(var i=0; i<10;i++){
			tower[i].setSpeed(0);
		}
		for(var i=0; i<5;i++){
			heart[i].setSpeed(0);
		} 
			
		
			
		}
	
		}
		else{
			var boundbut = kahang.y+50>tower[towerNum].y-175
			var boundleft = kahang.x-50<tower[towerNum].x+10
			var boundright = kahang.x+50>tower[towerNum].x-10
			
		if(boundbut&&boundleft&&boundright){
			diescore.show()
		playagainBut.show()
		die=true
			 for(var i=0; i<10;i++){
			tower[i].setSpeed(0);
		}
		for(var i=0; i<5;i++){
			heart[i].setSpeed(0);
		}
			
			//alert("=sdas")
		}
		
		}
		
	}


	function showHeart(heartNum){
		if(heart[heartNum].x <= 0){
			heart[heartNum].show();

		}
	}

	function moveBamboo(speed){	
		
		if(position <= tower[0].y+20){
			for(var i =0; i<10; i++){
				if(i==0||i==1||i==4||i==5){
				tower[i].addVector(0,speed);}
				else{
					tower[i].addVector(180,speed);
				}
			}			
		}if(position >= tower[0].y+20) {
			for(var i =0; i<10; i++){
				if(i==0||i==1||i==4||i==5){
				tower[i].addVector(180,speed);}
				else{
					tower[i].addVector(0,speed);
				}
			}
		}
		

	}
	function clickPlyagain(){
		if(playagainBut.isMouseDown()){
			 statusPlay = false
			 playkahang =false
			 die=false
			 score=-1
			 labelscore.HideBut()
		}
	}
	function checkclickbut()
	{
		if(but.isMouseDown())
		{
			scenePlay()
			
		}
	}
	function checkclickplay(){
		if(buttutorial.isMouseDown()){
			tutorial.hide()
			buttutorial.hide()

			playkahang =true
			playScene()
		}
	}
	function scenePlay(){
		statusPlay=true
		console.log("kelasd")
		scene.setSize(1024,650);
		background.changeImage("background3.jpg")
		background.setSpeed(0);
		background.setPosition(512,320);
		labelscore = new GameButton("คะแนน")
		labelscore.setPosition(420,20)
		tutorial =new Sprite(scene,"images/1x/manualModal.png",550,450);
		tutorial.setSpeed(0)
		tutorial.setPosition(512,320)
		buttutorial= new Sprite(scene,"images/1x/close.png",50,50)
		buttutorial.setSpeed(0)
		buttutorial.setPosition(740,135)
		diescore = new Sprite(scene,"images/1x/gameOverModal.png",550,450);
		diescore.setSpeed(0)
		diescore.setPosition(512,320)
		playagainBut = new Sprite(scene,"images/1x/playAgainBtn.png",150,50)
		playagainBut.setSpeed(0)
		playagainBut.setPosition(512,425)
		diescore.hide()
		playagainBut.hide()
		butLeft = new Sprite(scene,"images/1x/btnFly.png",200,100)
		butLeft.setSpeed(0)
		butLeft.setPosition(150,550)
		butRight = new Sprite(scene,"images/1x/btnFly.png",200,100)
		butRight.setSpeed(0)
		butRight.setPosition(874,550)

		
	
	
		for(var i=0; i<10;i++){
			tower[i] = new Tower(); 
			tower[i].setSpeed(0);
			tower[i].changeMoveAngleBy(180);

			if(i==0){
				tower[i].setPosition(200,Math.random()*50+40);
				position = tower[i].y;
			}
			else if(i%2==0){
				tower[i].setPosition(tower[i-2].x+200,Math.random()*50+40);
			}else{
				tower[i].changeImage("bottom.png");
				tower[i].setPosition(tower[i-1].x,tower[i-1].y+520);

			}
		
		}
		position2 = tower[2].y;
		for(var i=0; i<5;i++){
			heart[i] = new Heart();
			heart[i].setSpeed(0);
			heart[i].changeMoveAngleBy(180);

			heart[i].setPosition(tower[i*2].x,tower[i*2].y+250);
			
		}		
		kahang = new Kahang();
		kahang.setPosition(tower[0].x,tower[0].y+250)
		// kahang.setPosition(125,heart[0].y+50);

	}
	function playScene(){
		
		for(var i=0; i<10;i++){
			tower[i].setSpeed(2);
		}
		for(var i=0; i<5;i++){
			heart[i].setSpeed(2);
		}

	}
	

	function init(){
		// scenePlay();
		startScene();
	}
	
	function touch(){
		if(butLeft.isMouseDown()){
			alert("EZ")
		}
		if(butRight.isMouseDown()){
			alert("EZ")
		}
	}
	function update(){ 
		scene.clear();
		
		background.update();
		
		
		if(statusPlay){
		kahang.checkKeys();
		kahang.checkGravity();
	
		for(var i=0; i<10;i++){
			checkCollisionsTower(i);
			tower[i].update();
		}
		for(var i=0; i<5;i++){
			checkCollisions(i);
			showHeart(i);
			heart[i].update();

		}
		console.log("dasdas"+tower[0].x)
		if(score >= 10&&score<20){
			moveBamboo(0.5);			
		}
		if(score >= 20){
			moveBamboo(1);
		}
		butLeft.update()
		butRight.update()
		kahang.update();
		tutorial.update()
		buttutorial.update()
		console.log("w"+kahang.cWidth)
		diescore.update()
		playagainBut.update()
		checkclickplay()
		
		}
		else{
			but.update();
			kahangStart.update();
			logo.update();
			checkclickbut();
		}
		if(die){
			clickPlyagain()
		}
	}
	
	</script>
</head>
<body onload = "init()">


	<!-- <div>
		<input id="startBtn" type="image" src="images/1x/startBtn_1.png" alt="startBtn" onclick="scenePlay()" ></input> -->
</body>
</html>